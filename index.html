<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‚·æ¨¡æ“¬æŠ€è¡“è€ƒ-é‡è¿”921</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
            min-height: 100vh;
        }
        
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: rgba(31, 41, 55, 0.95);
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #dc2626;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background-color: #dc2626;
            color: white;
            font-weight: bold;
            padding: 16px 24px;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 12px;
            font-size: 20px;
            border: 1px solid #b91c1c;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 0 #991b1b;
        }

        .btn-primary:hover {
            background-color: #b91c1c;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #991b1b;
        }

        .btn-primary:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .btn-secondary {
            background-color: #4b5563;
            color: #f3f4f6;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 12px;
            font-size: 18px;
            border: 1px solid #374151;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #374151;
        }

        .btn-secondary:hover {
            background-color: #374151;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #374151;
        }
        
        .input-box {
            background-color: #1f2937;
            border: 2px solid #4b5563;
            color: white;
            border-radius: 8px;
            padding: 16px;
            width: 100%;
            font-size: 20px;
            margin-bottom: 16px;
            text-align: center;
            font-family: monospace;
            letter-spacing: 0.1em;
        }

        .input-box:focus {
            outline: none;
            border-color: #dc2626;
        }

        .timer-badge {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #000;
            color: #ef4444;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 1.5rem;
            border: 2px solid #b91c1c;
            font-family: monospace;
            letter-spacing: 0.1em;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .mission-box {
            background: rgba(17, 24, 39, 0.8);
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .hint-box {
            background: rgba(6, 78, 59, 0.3);
            border: 1px solid #059669;
            color: #34d399;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .choice-btn {
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .choice-img-container {
            width: 100%;
            height: 120px;
            background-color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .choice-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .choice-text {
            padding: 12px;
            font-size: 14px;
        }

        .sortable-item {
            background: #374151;
            border: 1px solid #4b5563;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .arrow-btn {
            background: #1f2937;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .arrow-btn:hover {
            background: #111827;
            transform: scale(1.1);
        }

        .arrow-btn:active {
            transform: scale(0.95);
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake-animation {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .pulse-red {
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        /* åœ–ç‰‡æ›¿ä»£æ–¹æ¡ˆ */
        .img-placeholder {
            background: #374151;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #9ca3af;
            font-size: 14px;
        }

        .img-placeholder-icon {
            font-size: 48px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        /* å ´æ™¯åœ–ç‰‡ */
        .scene-img {
            width: 100%;
            height: auto;
            display: block;
            min-height: 200px;
            background: #374151;
            border-radius: 8px;
        }

        /* å®Œæˆè­‰æ›¸æ¨£å¼ */
        .certificate {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 2px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: rotate(1deg);
        }

        .certificate-inner {
            background: #000;
            padding: 30px;
            border-radius: 6px;
            text-align: center;
        }

        .medal {
            font-size: 4rem;
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }
    </style>
</head>
<body>

<!-- Timer Display -->
<div id="gameTimer" class="timer-badge hidden">00:00</div>

<!-- Main Container -->
<div id="app" class="game-container">
    <div class="text-center">
        <p style="margin-top: 20px;">è¼‰å…¥ä¸­...</p>
    </div>
</div>

<script>
    // å…¨åŸŸç‹€æ…‹ç®¡ç†
    const state = {
        currentStage: 0,
        startTime: null,
        timerInterval: null,
        triageOrder: []
    };

    // GitHub Pages åœ–ç‰‡è·¯å¾‘è¨­å®š
    // è«‹å°‡åœ–ç‰‡ä¸Šå‚³åˆ° GitHub repository çš„ images è³‡æ–™å¤¾
    const IMAGE_PATH = './images/';
    
    // Padlet é€£çµ
    const padletLinks = {
        sos: "https://padlet.com/phyllis41/padlet-bl0b1p0sbf888tpq/wish/goElQyGMYV7vW3yY",
        patientC: "https://padlet.com/phyllis41/padlet-bl0b1p0sbf888tpq/wish/NvylWE5wGq03W0OX",
        patientA: "https://padlet.com/phyllis41/padlet-bl0b1p0sbf888tpq/wish/MxrmZYxq2AXdQGOq",
        patientD: "https://padlet.com/phyllis41/padlet-bl0b1p0sbf888tpq/wish/do3MQJPR5mNgW15w",
        final: "https://padlet.com/phyllis41/padlet-bl0b1p0sbf888tpq/wish/mDRxWB72G63Oajb1"
    };

    // å‚·æ‚£è³‡æ–™
    const victims = [
        { id: 'C', text: 'å‚·æ‚£Cï¼šè‡‰è‰²è’¼ç™½çœ¼ç¥æ½°æ•£ï¼Œå³æ‰‹æ‰‹è‚˜å› ä¸Šä¸€æ³¢åœ°éœ‡æ™‚è¢«æ‰è½é‹¼ç­‹æ°´æ³¥åˆ‡å‡ºæ·±æ·±çš„å‚·å£ï¼Œè¡€æ¶²ä¸æ–·çš„å™´å‡º', desc: 'å³æ‰‹è‚˜å‹•è„ˆç ´è£‚' },
        { id: 'A', text: 'å‚·æ‚£Aï¼šé›™æ‰‹å£“è‘—å¤§è…¿ï¼Œè¡€æ¶²ä¸€ç›´å¾æŒ‡ç¸«é–“æµå‡ºï¼Œæ˜é¡¯é‹å‹•è¤²éƒ½è¢«æŸ“ç´…äº†', desc: 'é›™æ‰‹å£“å¤§è…¿' },
        { id: 'D', text: 'å‚·æ‚£Dï¼šè‡‰ä¸Šæœ‰è¡€ç—•ï¼Œå‘†ååœ¨åœ°ä¸Šã€å‘¼å¸æœ‰é»å–˜ï¼Œä¸èªªè©±', desc: 'è‡‰æœ‰è¡€ç—•ã€å‘†å' }, 
        { id: 'E', text: 'å‚·æ‚£Eï¼šå‰›å‰›è·‘å‡ºæ•™å®¤æ™‚ï¼Œæˆ‘èƒ¸å£è¢«æ‰ä¸‹ä¾†çš„ç‡ˆç®¡ç ¸åˆ°å¥½ç—›', desc: 'è§€å¯Ÿå‘¼å¸å¹³é †' },
        { id: 'B', text: 'å‚·æ‚£Bï¼šåš‡æ­»æˆ‘äº†ï¼Œé‚„æœ‰æœ‰ä½ å€‘ï¼Œä¸ç„¶æˆ‘éƒ½è…¿è»Ÿå‹•ä¸äº†....', desc: 'è…¿è»Ÿä½†å¯å°è©±' }
    ];
    const correctTriageOrder = ['C', 'A', 'D', 'E', 'B'];

    // è¨ˆæ™‚å™¨
    function startTimer() {
        state.startTime = Date.now();
        document.getElementById('gameTimer').classList.remove('hidden');
        
        state.timerInterval = setInterval(() => {
            const delta = Date.now() - state.startTime;
            const minutes = Math.floor(delta / 60000);
            const seconds = Math.floor((delta % 60000) / 1000);
            document.getElementById('gameTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(state.timerInterval);
        return document.getElementById('gameTimer').textContent;
    }

    // å‰µå»ºåœ–ç‰‡å…ƒç´ 
    function createImage(filename, alt, fallbackIcon) {
        const container = document.createElement('div');
        container.className = 'choice-img-container';
        
        const img = document.createElement('img');
        img.src = IMAGE_PATH + filename;
        img.alt = alt;
        img.className = 'choice-img';
        
        img.onerror = function() {
            container.innerHTML = `
                <div class="img-placeholder">
                    <div class="img-placeholder-icon">${fallbackIcon}</div>
                    <div>${alt}</div>
                </div>
            `;
        };
        
        container.appendChild(img);
        return container.outerHTML;
    }

    // æ¸²æŸ“å‡½æ•¸
    function render() {
        const app = document.getElementById('app');
        app.innerHTML = '';
        app.className = 'game-container fade-in';
        
        const content = stages[state.currentStage]();
        app.innerHTML = content.html;
        
        if (content.init) {
            setTimeout(content.init, 100);
        }
    }

    // è¼¸å…¥é©—è­‰å…ƒä»¶
    function createInputValidator(correctCode, altCodes, successCallback, errorMsg) {
        return function() {
            const input = document.getElementById('codeInput');
            const value = input.value.trim();
            
            if (value === correctCode || (altCodes && altCodes.includes(value))) {
                successCallback();
            } else {
                input.classList.add('shake-animation');
                alert(errorMsg || 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥');
                setTimeout(() => input.classList.remove('shake-animation'), 500);
            }
        };
    }

    // é—œå¡å…§å®¹
    const stages = {
        // é–‹å§‹ç•«é¢
        0: () => ({
            html: `
                <div class="text-center">
                    <div style="border: 4px solid #dc2626; display: inline-block; padding: 8px; border-radius: 50%; margin-bottom: 24px;" class="pulse-red">
                        <span style="font-size: 4rem;">âš ï¸</span>
                    </div>
                    <h1>å¤§å‚·æ¨¡æ“¬</h1>
                    <h2 style="color: white;">é‡è¿” 921</h2>
                    
                    <div class="mission-box" style="margin: 32px 0; text-align: left;">
                        <p style="color: #ef4444; font-weight: bold; margin-bottom: 8px;">
                            âš ï¸ ä»»å‹™ç°¡å ±
                        </p>
                        <p style="color: #d1d5db; line-height: 1.6;">
                            åœ°é¢åŠ‡çƒˆæ–æ™ƒï¼Œå»ºç¯‰ç‰©åå¡Œã€‚ä½ å€‘è¢«å›°åœ¨ç½é›£ç¾å ´ã€‚<br>
                            å¤–ç•Œæ•‘æ´éœ€è¦æ™‚é–“ï¼Œä½ å€‘åªæœ‰ <span style="color: #ef4444; font-weight: bold; font-size: 1.2em;">15åˆ†é˜</span>ã€‚
                        </p>
                        <p style="color: #d1d5db; margin-top: 12px;">
                            ä»»å‹™ç›®æ¨™ï¼šä¾ç…§ <strong style="color: white;">START æª¢å‚·åˆ†é¡</strong> æ–½ä»¥æ€¥æ•‘ï¼Œç©©å®šå‚·è€…ã€‚
                        </p>
                    </div>
                    
                    <button id="startBtn" class="btn-primary pulse-red">
                        é–‹å§‹ä»»å‹™
                    </button>
                </div>
            `,
            init: function() {
                document.getElementById('startBtn').onclick = function() {
                    startTimer();
                    state.currentStage = 1;
                    render();
                };
            }
        }),

        // åœ°éœ‡åæ‡‰
        1: () => ({
            html: `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; border-bottom: 1px solid #374151; padding-bottom: 8px;">
                        <h2>âš ï¸ ç·Šæ€¥ç‹€æ³</h2>
                        <span style="background: #7f1d1d; color: #fca5a5; padding: 4px 8px; border-radius: 4px; font-size: 12px;">LIVE</span>
                    </div>
                    <p style="font-size: 18px; margin-bottom: 8px; color: #d1d5db;">åœ°é»ï¼šå¥åº·èˆ‡è­·ç†æ•™å®¤</p>
                    <p style="font-size: 24px; font-weight: bold; margin-bottom: 24px; text-align: center;">åœ°éœ‡ç™¼ç”Ÿä¸­ï¼ä½ çš„ç¬¬ä¸€åæ‡‰ï¼Ÿ</p>
                    
                    <div class="choice-grid">
                        <button class="btn-secondary choice-btn" onclick="checkEarthquakeAnswer(true)">
                            ${createImage('desk.png', 'æ¡Œå­', 'ğŸª‘')}
                            <div class="choice-text">èº²åœ¨æ¡Œå­ä¸‹</div>
                        </button>
                        <button class="btn-secondary choice-btn" onclick="checkEarthquakeAnswer(false)">
                            ${createImage('chair.png', 'æ¤…å­', 'ğŸ’º')}
                            <div class="choice-text">èº²åœ¨æ¤…å­æ—</div>
                        </button>
                        <button class="btn-secondary choice-btn" onclick="checkEarthquakeAnswer(false)">
                            ${createImage('pillar.png', 'æŸ±å­', 'ğŸ›ï¸')}
                            <div class="choice-text">æŠ±ä½æŸ±å­</div>
                        </button>
                        <button class="btn-secondary choice-btn" onclick="checkEarthquakeAnswer(false)">
                            ${createImage('door.png', 'é–€', 'ğŸšª')}
                            <div class="choice-text">è¡åˆ°é–€é‚Š</div>
                        </button>
                    </div>
                </div>
            `,
            init: function() {
                window.checkEarthquakeAnswer = function(correct) {
                    if (correct) {
                        state.currentStage = 2;
                        render();
                    } else {
                        alert('è­¦å‘Šï¼éŒ¯èª¤é¸æ“‡å¯èƒ½å°è‡´è‡´å‘½å¾Œæœã€‚\\nåœ°éœ‡æ™‚æ‡‰ç«‹å³ã€Œè¶´ä¸‹ã€æ©è­·ã€ç©©ä½ã€ã€‚');
                    }
                };
            }
        }),

        // éœ‡å¾Œè©•ä¼°
        2: () => ({
            html: `
                <div>
                    <h2 style="color: #9ca3af;">ç¾å ´ç‹€æ³è©•ä¼°</h2>
                    <div style="background: #1f2937; padding: 20px; border-radius: 8px; margin-bottom: 24px; border: 2px solid #374151;">
                        <img src="${IMAGE_PATH}classroom.png" alt="åœ°éœ‡å¾Œæ•™å®¤" class="scene-img" 
                             onerror="this.outerHTML='<div class=&quot;img-placeholder&quot; style=&quot;height: 200px;&quot;><div class=&quot;img-placeholder-icon&quot;>ğŸšï¸</div><div>åœ°éœ‡å¾Œæ•™å®¤å ´æ™¯</div></div>'">
                        <p style="font-size: 18px; color: #d1d5db; text-align: center; margin-top: 16px;">
                            æ™ƒå‹•åœæ­¢ã€‚æ•™å®¤çµæ§‹å—æï¼Œç‰©å“æ•£è½ã€‚
                        </p>
                    </div>
                    <button id="nextBtn" class="btn-primary" style="background: #1e40af; border-color: #1e3a8a;">
                        ä¸‹ä¸€æ­¥è¡Œå‹• â†’
                    </button>
                </div>
            `,
            init: function() {
                document.getElementById('nextBtn').onclick = function() {
                    state.currentStage = 3;
                    render();
                };
            }
        }),

        // é¸æ“‡å‡ºå£
        3: () => ({
            html: `
                <div>
                    <h2>å°‹æ‰¾é€ƒç”Ÿå‡ºå£</h2>
                    <p style="color: #9ca3af; margin-bottom: 16px;">åˆ¤æ–·æœ€å®‰å…¨çš„æ’¤é›¢è·¯å¾‘</p>
                    
                    <div style="margin-bottom: 24px;">
                        <img src="${IMAGE_PATH}exits.png" alt="é€ƒç”Ÿå‡ºå£" class="scene-img" 
                             onerror="this.outerHTML='<div class=&quot;img-placeholder&quot; style=&quot;height: 200px;&quot;><div class=&quot;img-placeholder-icon&quot;>ğŸšª</div><div>æ•™å®¤å‡ºå£é…ç½®åœ–</div></div>'">
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn-secondary" onclick="selectDoor('A')" style="display: flex; align-items: center;">
                            <span style="background: #111827; padding: 4px 12px; border-radius: 4px; margin-right: 12px; color: #ef4444; font-family: monospace;">A</span>
                            æ•™å®¤å¤§é–€ (ç»ç’ƒç ´æ)
                        </button>
                        <button class="btn-secondary" onclick="selectDoor('B')" style="display: flex; align-items: center;">
                            <span style="background: #111827; padding: 4px 12px; border-radius: 4px; margin-right: 12px; color: #ef4444; font-family: monospace;">B</span>
                            æ®˜éšœæ­¥é“å´é–€
                        </button>
                        <button class="btn-secondary" onclick="selectDoor('C')" style="display: flex; align-items: center;">
                            <span style="background: #111827; padding: 4px 12px; border-radius: 4px; margin-right: 12px; color: #ef4444; font-family: monospace;">C</span>
                            å¾Œæ–¹å°é–€
                        </button>
                    </div>
                </div>
            `,
            init: function() {
                window.selectDoor = function(door) {
                    if (door === 'A') {
                        state.currentStage = 4;
                        render();
                    } else if (door === 'B') {
                        alert('é€šé“å—é˜»ï¼šå´é–€è®Šå½¢å¡æ­»ï¼Œç„¡æ³•é–‹å•Ÿã€‚');
                    } else {
                        alert('å±éšªå€åŸŸï¼šå¾Œæ–¹å°é–€ä¸Šæ–¹æœ‰æ‡¸æ›ç‰©ï¼Œä¸”ä½æ–¼å»ºç¯‰è£‚ç¸«æ­£ä¸‹æ–¹ã€‚');
                    }
                };
            }
        }),

        // å°å¤–æ±‚æ´
        4: () => ({
            html: `
                <div>
                    <div style="display: flex; align-items: center; margin-bottom: 16px;">
                        <span style="font-size: 2rem; margin-right: 12px;">ğŸ“</span>
                        <div>
                            <h2 style="font-size: 20px; margin-bottom: 4px;">å°å¤–æ±‚æ´</h2>
                            <p style="font-size: 12px; color: #3b82f6;">ç›®å‰ä½ç½®ï¼šå¥åº·è­·ç†æ•™å®¤</p>
                        </div>
                    </div>
                    
                    <div style="background: #1f2937; padding: 20px; border-radius: 8px; margin-bottom: 24px; border: 2px solid #374151;">
                        <img src="${IMAGE_PATH}map.png" alt="æ ¡åœ’åœ°åœ–" class="scene-img" 
                             onerror="this.outerHTML='<div class=&quot;img-placeholder&quot; style=&quot;height: 200px;&quot;><div class=&quot;img-placeholder-icon&quot;>ğŸ—ºï¸</div><div>æ ¡åœ’åœ°åœ–</div></div>'">
                    </div>

                    <div style="text-align: center; margin-bottom: 24px;">
                        <span style="font-size: 3rem; display: inline-block; margin-bottom: 16px;">ğŸ“</span>
                        <p style="margin-bottom: 16px;">é»æ“Šä¸‹æ–¹é€£çµé€²è¡Œé€šè©±éŒ„éŸ³</p>
                        <a href="${padletLinks.sos}" 
                           target="_blank" 
                           class="btn-primary"
                           style="background: #dc2626;">
                            é–‹å§‹éŒ„éŸ³å ±æ¡ˆ
                        </a>
                    </div>

                    <div class="hint-box">
                        <span style="margin-right: 8px;">ğŸ“¡</span>
                        ä»»å‹™ï¼šé»æ“Šä¸Šæ–¹æŒ‰éˆ•é€²è¡Œé€šè©±éŒ„éŸ³ï¼Œå®Œæˆå¾Œè¼¸å…¥å°ˆç·šè™Ÿç¢¼ã€‚
                    </div>

                    <input type="text" id="codeInput" class="input-box" placeholder="è¼¸å…¥å ±æ¡ˆå°ˆç·š">
                    <button id="sosBtn" class="btn-primary">ç¢ºèªé€šè¨Šé€£çµ</button>
                </div>
            `,
            init: function() {
                document.getElementById('sosBtn').onclick = createInputValidator(
                    '119',
                    ['112', '110'],
                    () => { state.currentStage = 5; render(); },
                    'é€šè¨Šå¤±æ•—ï¼šè«‹è¼¸å…¥æ­£ç¢ºçš„ç·Šæ€¥å ±æ¡ˆè™Ÿç¢¼'
                );
            }
        }),

        // ç‰©è³‡æœå°‹
        5: () => ({
            html: `
                <div>
                    <h2 style="color: #10b981;">ğŸ¥ ç‰©è³‡æœå°‹</h2>
                    
                    <div style="margin-bottom: 24px;">
                        <img src="${IMAGE_PATH}supplies.png" alt="æ€¥æ•‘ç‰©è³‡" class="scene-img" 
                             onerror="this.outerHTML='<div class=&quot;img-placeholder&quot; style=&quot;height: 200px;&quot;><div class=&quot;img-placeholder-icon&quot;>ğŸ¥</div><div>æ€¥æ•‘ç‰©è³‡ä½ç½®</div></div>'">
                    </div>
                    
                    <div class="hint-box" style="border-color: #059669; background: rgba(5, 150, 105, 0.1);">
                        æç¤ºï¼šå¥åº·ä¸­å¿ƒæœ‰èªªéï¼Œå­¸å‹™è™•æœƒæ”¾æ€¥æ•‘ç‰©è³‡ï¼Œå°‹æ‰¾æ€¥æ•‘åŒ…ä¸Šçš„ç·¨è™Ÿä»¥è§£é–ã€‚
                    </div>

                    <input type="text" id="codeInput" class="input-box" style="color: #10b981; border-color: #047857;" placeholder="ENTER PASSCODE">
                    <button id="supplyBtn" class="btn-primary" style="background: #059669; border-color: #047857;">UNLOCK KIT</button>
                </div>
            `,
            init: function() {
                document.getElementById('supplyBtn').onclick = createInputValidator(
                    '8324123',
                    ['832428', '832444'],
                    () => { state.currentStage = 6; render(); },
                    'ACCESS DENIED - å¯†ç¢¼éŒ¯èª¤'
                );
            }
        }),

        // ç’°å¢ƒå®‰å…¨
        6: () => ({
            html: `
                <div>
                    <div style="border-left: 4px solid #f59e0b; padding-left: 16px; margin-bottom: 24px;">
                        <h2 style="color: #f59e0b;">æ¥è§¸å‚·æ‚£</h2>
                        <p style="color: #9ca3af;">åœ°é»ï¼šä¸­å»Š (å»ºç¯‰ç‰©é€£æ¥è™•)</p>
                    </div>
                    
                    <p style="font-size: 20px; margin-bottom: 32px; line-height: 1.8;">
                        ç™¼ç¾ä¸‰ä½åŒå­¸å“€è™Ÿã€‚ä¸Šæ–¹æœ‰æ‰è½ç¢çŸ³ã€‚<br>ä½ çš„é¦–è¦è¡Œå‹•ï¼Ÿ
                    </p>
                    
                    <button class="btn-secondary" onclick="checkSafety(true)" style="padding: 24px;">
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 2rem; margin-right: 16px; color: #f59e0b;">ğŸƒ</span>
                            <div style="text-align: left;">
                                <div style="font-size: 18px; font-weight: bold;">å»ºç«‹å®‰å…¨å€</div>
                                <div style="font-size: 14px; color: #9ca3af;">å¿«é€Ÿç§»å‹•è‡³ç©ºæ› è™• (Scene Safety)</div>
                            </div>
                        </div>
                    </button>
                    
                    <button class="btn-secondary" onclick="checkSafety(false)" style="padding: 24px;">
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 2rem; margin-right: 16px; color: #6b7280;">ğŸ©¹</span>
                            <div style="text-align: left;">
                                <div style="font-size: 18px; font-weight: bold;">åŸåœ°æ€¥æ•‘</div>
                                <div style="font-size: 14px; color: #9ca3af;">æ‹¿å‡ºæ­¢è¡€å¸¶å”åŠ©æ­¢è¡€</div>
                            </div>
                        </div>
                    </button>
                </div>
            `,
            init: function() {
                window.checkSafety = function(correct) {
                    if (correct) {
                        state.currentStage = 7;
                        render();
                    } else {
                        alert('å±éšªï¼ä½ è™•æ–¼ã€Œç†±å€ã€(Hot Zone)ã€‚\\nSMARTERåŸå‰‡ç¬¬ä¸€æ¢ï¼šScene Safetyã€‚è«‹å…ˆç¢ºä¿è‡ªèº«èˆ‡å‚·æ‚£è„«é›¢å±éšªç’°å¢ƒã€‚');
                    }
                };
            }
        }),

        // æª¢å‚·åˆ†é¡
        7: () => ({
            html: `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 16px;">
                        <h2 style="color: #ef4444;">START æª¢å‚·åˆ†é¡</h2>
                        <span style="font-size: 12px; color: #9ca3af;">é»æ“Šç®­é ­æ’åº</span>
                    </div>
                    
                    <div id="triageList" style="margin-bottom: 24px;">
                        è¼‰å…¥ä¸­...
                    </div>
                    
                    <button id="checkSortBtn" class="btn-primary">ç¢ºèªå„ªå…ˆé †åº</button>
                </div>
            `,
            init: function() {
                // åˆå§‹åŒ–æ’åº
                if (state.triageOrder.length === 0) {
                    state.triageOrder = [...victims].sort(() => Math.random() - 0.5);
                }
                
                // å…¨åŸŸå‡½æ•¸å¿…é ˆåœ¨é€™è£¡å®šç¾©
                window.moveTriageItem = function(index, direction) {
                    const newIndex = index + direction;
                    if (newIndex >= 0 && newIndex < state.triageOrder.length) {
                        // äº¤æ›ä½ç½®
                        const temp = state.triageOrder[index];
                        state.triageOrder[index] = state.triageOrder[newIndex];
                        state.triageOrder[newIndex] = temp;
                        renderTriageList();
                    }
                };
                
                // æ¸²æŸ“å‚·æ‚£åˆ—è¡¨çš„å‡½æ•¸
                function renderTriageList() {
                    const list = document.getElementById('triageList');
                    if (!list) return;
                    
                    list.innerHTML = state.triageOrder.map((item, index) => {
                        return `
                            <div class="sortable-item">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; font-size: 14px; color: white;">${item.text}</div>
                                    <div style="font-size: 12px; color: #9ca3af;">${item.desc}</div>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 4px; margin-left: 8px;">
                                    <button class="arrow-btn" onclick="moveTriageItem(${index}, -1)">â–²</button>
                                    <button class="arrow-btn" onclick="moveTriageItem(${index}, 1)">â–¼</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // åˆå§‹æ¸²æŸ“
                renderTriageList();
                
                // ç¢ºèªæŒ‰éˆ•
                const checkBtn = document.getElementById('checkSortBtn');
                if (checkBtn) {
                    checkBtn.onclick = function() {
                        const currentOrderIds = state.triageOrder.map(v => v.id);
                        if (JSON.stringify(currentOrderIds) === JSON.stringify(correctTriageOrder)) {
                            state.currentStage = 8;
                            render();
                        } else {
                            alert('æª¢å‚·é‚è¼¯éŒ¯èª¤ã€‚\\nå›æ†¶ START åŸå‰‡ï¼š\\n1. èƒ½èµ°å—ï¼Ÿ\\n2. æœ‰å‘¼å¸å—ï¼Ÿ\\n3. å‘¼å¸é »ç‡/å¾®è¡€ç®¡å……å¡«/æ„è­˜ç‹€æ…‹');
                        }
                    };
                }
            }
        }),

        // æ€¥æ•‘è™•ç†ï¼ˆé€šç”¨æ¨¡æ¿ï¼‰
        8: () => createTreatmentStage('C', 'å³æ‰‹æ‰‹è‚˜åˆ‡å‡ºæ·±æ·±çš„å‚·å£ï¼Œè¡€æ¶²ä¸æ–·çš„å™´å‡ºï¼Œç”¨è‡ªå·±çš„å·¦æ‰‹æ‰‹å£“ä½å‚·å£', padletLinks.patientC, 'wd343', 9),
        9: () => createTreatmentStage('A', 'å‚·å£åœ¨å·¦å¤§è…¿å¤–å´å¤§é‡å‡ºè¡€ä¸­', padletLinks.patientA, 'stop893', 10),
        10: () => createTreatmentStage('D', 'ç›®æ“Šè€…èªªçœ‹åˆ°æ‚£è€…çªç„¶æŠ±èƒ¸ç—›è‹¦å€’ä¸‹å¾Œå°±ç„¡åæ‡‰', padletLinks.patientD, '741314', 11),

        // æˆ°è¡“æ±ºç­–
        11: () => ({
            html: `
                <div>
                    <h2 style="color: #3b82f6; margin-bottom: 16px;">æˆ°è¡“æ±ºç­–</h2>
                    <p style="margin-bottom: 24px; color: #d1d5db;">åˆæ­¥æª¢å‚·å®Œæˆã€‚è«‹å‹¾é¸å¾ŒçºŒè¡Œå‹•æ–¹æ¡ˆ (è¤‡é¸)ï¼š</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                        <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid #4b5563; border-radius: 8px; cursor: pointer; background: #1f2937;">
                            <input type="checkbox" value="1" style="width: 24px; height: 24px;">
                            <span>æŒ‡æ´¾äººå“¡å¼•å°æ•‘è­·è»Š</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid #4b5563; border-radius: 8px; cursor: pointer; background: #1f2937;">
                            <input type="checkbox" value="2" style="width: 24px; height: 24px;">
                            <span>ç•™å®ˆäººå“¡ç›£æ¸¬å‚·æ‚£ç”Ÿå‘½å¾µè±¡</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid #4b5563; border-radius: 8px; cursor: pointer; background: #1f2937;">
                            <input type="checkbox" value="3" style="width: 24px; height: 24px;">
                            <span>å¤–åœå·¡é‚æœå°‹å…¶ä»–å€–å­˜è€…</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid #4b5563; border-radius: 8px; cursor: pointer; background: #1f2937;">
                            <input type="checkbox" value="4" style="width: 24px; height: 24px;">
                            <span>å…¨å“¡é€²å…¥å»ºç¯‰ç‰©æ·±åº¦æœç´¢</span>
                        </label>
                    </div>
                    
                    <button id="multiSubmit" class="btn-primary">ç¢ºèªéƒ¨ç½²</button>
                </div>
            `,
            init: function() {
                document.getElementById('multiSubmit').onclick = function() {
                    const checked = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                    const isCorrect = checked.includes('1') && checked.includes('2') && checked.includes('3') && 
                                    !checked.includes('4') && checked.length === 3;
                    
                    if (isCorrect) {
                        state.currentStage = 12;
                        render();
                    } else {
                        alert('è«‹é‡æ–°æ€è€ƒï¼š\\n1. å¤–éƒ¨æ•‘æ´éœ€è¦å¼•å°å—ï¼Ÿ\\n2. å‚·æ‚£æ˜¯å¦éœ€è¦æŒçºŒç›£æ§ï¼Ÿ\\n3. å»ºç¯‰çµæ§‹æ˜¯å¦å®‰å…¨ï¼Ÿ');
                    }
                };
            }
        }),

        // æœ€çµ‚éª¨æŠ˜è™•ç†
        12: () => ({
            html: `
                <div>
                    <div style="background: #7f1d1d; color: white; text-align: center; padding: 8px; margin-bottom: 16px; font-weight: bold; letter-spacing: 0.1em;" class="pulse-red">
                        !!! NEW CASUALTY DETECTED !!!
                    </div>
                    <h2 style="font-size: 20px; margin-bottom: 8px;">è¡Œæ”¿å¤§æ¨“å‰</h2>
                    <p style="color: #ef4444; margin-bottom: 16px; font-weight: bold; border-bottom: 1px solid #7f1d1d; padding-bottom: 8px;">
                        å‚·å‹¢ï¼šå·¦å°è…¿é–‰é–æ€§éª¨æŠ˜ (ç„¡å‡ºè¡€å°è…¿æˆå¥‡æ€ªè§’åº¦)
                    </p>
                    
                    <div style="background: #1f2937; padding: 16px; border-radius: 8px; border: 1px solid #374151; margin-bottom: 24px;">
                        <ul style="list-style: none; padding: 0; margin: 0; color: #d1d5db; font-size: 14px;">
                            <li style="margin-bottom: 8px;">â¤ ç„¡å‡ºè¡€ç„¡å‚·å£</li>
                            <li style="margin-bottom: 8px;">â¤ ä»»å‹™ï¼šé€²è¡Œéª¨æŠ˜å›ºå®š</li>
                            <li style="margin-bottom: 16px;">â¤ ç´€éŒ„ï¼šå¤šè§’åº¦æ‹æ”ä¸Šå‚³</li>
                        </ul>
                        <a href="${padletLinks.final}" 
                           target="_blank" 
                           class="btn-primary" 
                           style="background: #f59e0b; border-color: #d97706; display: block; text-align: center;">
                            ğŸ“¸ UPLOAD EVIDENCE
                        </a>
                    </div>

                    <input type="text" id="codeInput" class="input-box" placeholder="FINAL CODE">
                    <button id="btnEnd" class="btn-primary">MISSION COMPLETE</button>
                </div>
            `,
            init: function() {
                document.getElementById('btnEnd').onclick = createInputValidator(
                    'end',
                    [],
                    () => { 
                        state.currentStage = 13; 
                        render(); 
                    },
                    'è«‹è¼¸å…¥æ­£ç¢ºçš„æœ€çµ‚å¯†ç¢¼'
                );
            }
        }),

        // å®Œæˆè­‰æ›¸
        13: () => {
            const finalTime = stopTimer();
            return {
                html: `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 80vh;">
                        <div class="certificate" style="width: 100%; max-width: 500px;">
                            <div class="certificate-inner">
                                <div class="medal">ğŸ…</div>
                                <h1 style="font-size: 2rem; margin: 16px 0; text-transform: uppercase;">MISSION ACCOMPLISHED</h1>
                                <p style="color: #f59e0b; font-family: monospace; margin-bottom: 16px; font-size: 20px;">ELITE RESCUE TEAM</p>
                                
                                <div style="border-top: 1px solid #4b5563; border-bottom: 1px solid #4b5563; padding: 16px; margin: 16px 0; background: #111827;">
                                    <p style="color: #9ca3af; font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px;">Total Operation Time</p>
                                    <p style="font-size: 3rem; font-family: monospace; font-weight: bold; color: #ef4444;">${finalTime}</p>
                                </div>
                                
                                <div style="text-align: left; font-size: 14px; color: #d1d5db; margin-top: 16px;">
                                    <p style="margin-bottom: 8px;">âœ… è£å‚™æ­¸ä½ï¼šæ€¥æ•‘åŒ…ã€åŒ…ç´®ç”¨å“</p>
                                    <p style="margin-bottom: 8px;">âœ… æ•¸æ“šå›å ±ï¼šå¡«å¯«å¾Œæ¸¬è¡¨å–®</p>
                                    <p style="margin-bottom: 8px;">âœ… æ­¤é é¢æˆªåœ–ï¼šå³ä¸Šé–å®šéµï¼‹Homeéµ</p>
                                    <p>âœ… èªè­‰ï¼šå‘æŒ‡æ®å®˜(è€å¸«)é ˜å–è­‰ç…§</p>
                                </div>
                            </div>
                        </div>
                        
                        <p style="color: #ef4444; font-weight: bold; margin: 24px 0; font-size: 18px;" class="pulse-red">
                            ğŸ“¸ SCREENSHOT THIS RECORD
                        </p>
                        
                        <button onclick="location.reload()" style="color: #6b7280; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em;">
                            Restart Simulation
                        </button>
                    </div>
                `,
                init: function() {}
            };
        }
    };

    // æ€¥æ•‘è™•ç†é—œå¡æ¨¡æ¿
    function createTreatmentStage(patient, desc, padletLink, password, nextStage) {
        return {
            html: `
                <div>
                    <div class="mission-box" style="border-left-color: #dc2626;">
                        <h2 style="font-size: 20px; color: #ef4444; margin-bottom: 4px;">
                            ${patient === 'C' ? 'å„ªå…ˆ' : 'æ¬¡è¦'}ç›®æ¨™ï¼šå‚·æ‚£ ${patient}
                        </h2>
                        <p style="color: white;">${desc}</p>
                    </div>

                    <div style="background: #1f2937; padding: 16px; border-radius: 8px; border: 1px solid #374151; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #9ca3af; margin-bottom: 8px; font-family: monospace;">TASK_PROTOCOL:</p>
                        <ul style="list-style: none; padding: 0; margin: 0 0 16px 0; color: #d1d5db; font-size: 14px;">
                            <li style="margin-bottom: 8px;">âœ“ ä¸»æ‰‹é€²è¡Œæ€¥æ•‘è™•ç½®</li>
                            <li style="margin-bottom: 8px;">âœ“ å‰¯æ‰‹éŒ„å½±ä¸¦æ‹ç…§å­˜è­‰</li>
                            <li style="margin-bottom: 8px;">âœ“ è³‡æ–™ä¸Šå‚³é›²ç«¯</li>
                        </ul>
                        <a href="${padletLink}" 
                           target="_blank" 
                           class="btn-primary" 
                           style="background: #f59e0b; border-color: #d97706; display: block; text-align: center;">
                            â˜ï¸ ä¸Šå‚³ç¾å ´ç´€éŒ„ (Padlet)
                        </a>
                    </div>

                    <input type="text" id="codeInput" class="input-box" placeholder="å‚·æ‚£ç”Ÿå‘½å¯†ç¢¼">
                    <button id="btnTreat" class="btn-primary">ä»»å‹™ç¢ºèª</button>
                </div>
            `,
            init: function() {
                document.getElementById('btnTreat').onclick = createInputValidator(
                    password.toLowerCase(),
                    [],
                    () => { state.currentStage = nextStage; render(); },
                    'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥'
                );
            }
        };
    }

    // åˆå§‹åŒ–
    window.onload = function() {
        setTimeout(() => {
            render();
        }, 500);
    };

    // å…¨åŸŸéŒ¯èª¤è™•ç†
    window.onerror = function(msg, url, lineNo, columnNo, error) {
        console.error('éŒ¯èª¤:', msg, 'at line', lineNo);
        return true;
    };
</script>

</body>
</html>
